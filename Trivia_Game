# cyber_trivia_app.py
from flask import Flask, jsonify, request, render_template_string, send_from_directory
import random
import os

app = Flask(__name__)

# ---------------------
# CONFIG
# ---------------------
TOTAL_QUESTIONS = 150  # configurable
# ---------------------
# QUESTIONS DATASET (150 question objects)
# Each question: id (1-based), text, options (list), answer (index), type (mcq|tf), difficulty, tgif (emoji string), image (optional path)
# NOTE: Add images into static/images/ with same filenames if you want image-based questions to display.
# ---------------------
QUESTIONS = [
    # 1
    {"id":1, "text":"What does the abbreviation 'CIA' stand for in information security?",
     "options":["Confidentiality, Integrity, Availability","Correct, Integrity, Availability","Confidentiality, Identification, Authorization","Control, Integrity, Access"],
     "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”’ğŸ§¾ğŸ¯", "image":None},
    # 2
    {"id":2, "text":"True or False: A strong password should include only letters to make it easier to remember.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ”‘ğŸ˜…", "image":None},
    # 3
    {"id":3, "text":"Which of the following is a common sign of a phishing email?",
     "options":["Unexpected request for credentials","Perfect grammar and personalization","Email from your personal account","Attachmentless email with only signature"],
     "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“§ğŸŸâš ï¸", "image":"/static/images/phish_example1.png"},
    # 4
    {"id":4, "text":"What is the primary purpose of a firewall?",
     "options":["To physically protect the server room","To monitor and control incoming/outgoing network traffic","To perform backups","To speed up the internet"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ§±ğŸŒ", "image":None},
    # 5
    {"id":5, "text":"Which protocol is used to securely browse the web?",
     "options":["HTTP","FTP","SMTP","HTTPS"],
     "answer":3, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸŒğŸ”", "image":None},
    # 6
    {"id":6, "text":"Which one is an example of multi-factor authentication?",
     "options":["Password only","Password + SMS code","Password typed twice","Password + username"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“±ğŸ”âœ…", "image":None},
    # 7
    {"id":7, "text":"True or False: Social engineering only happens online.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ§ ğŸ­", "image":None},
    # 8
    {"id":8, "text":"What does 'malware' stand for?",
     "options":["Malfunctioning hardware","Malicious software","Mail warehousing","Managed software"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ›ğŸ’»âš ï¸", "image":None},
    # 9
    {"id":9, "text":"Which is NOT a type of malware?",
     "options":["Virus","Worm","Phishing","Ransomware"],
     "answer":2, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ¦ ğŸ“›", "image":None},
    # 10
    {"id":10, "text":"Which of these practices improves security for web applications?",
     "options":["Storing passwords in plain text","Using parameterized queries to prevent SQL injection","Allowing long filenames only","Disabling HTTPS"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ›¡ï¸ğŸ§©", "image":None},
    # 11
    {"id":11, "text":"What is 'patch management'?",
     "options":["Deploying UI updates only","Process of applying updates/fixes to software","Backing up data to tape","Managing user passwords"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ©¹ğŸ”", "image":None},
    # 12
    {"id":12, "text":"Which port is the default for HTTPS?",
     "options":["80","22","443","25"], "answer":2, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸŒğŸ”’", "image":None},
    # 13
    {"id":13, "text":"True or False: Using public Wi-Fi to access sensitive work resources without VPN is safe.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ“¶âš ï¸", "image":None},
    # 14
    {"id":14, "text":"Which of the following is a secure way to share passwords within a team?",
     "options":["Email the password","Write it on a sticky note","Use a password manager","Share via public chat room"],
     "answer":2, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”ğŸ“", "image":None},
    # 15
    {"id":15, "text":"What technique does 'brute force attack' use?",
     "options":["Phishing users","Trying many possible passwords until success","Encrypting data","Distributing ransomware"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ’ªğŸ”", "image":None},
    # 16
    {"id":16, "text":"What does 'XSS' stand for in web security?",
     "options":["Cross-site Scripting","Extended Secure Socket","Cross-site Safeguard","Executable Script Syntax"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸŒâš ï¸ğŸ’¬", "image":None},
    # 17
    {"id":17, "text":"Which is the best definition of 'phishing'?",
     "options":["A targeted DDoS attack","Tricking users into revealing sensitive info","Encrypting data for ransom","Spoofing a wireless network"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ£ğŸ“§", "image":None},
    # 18
    {"id":18, "text":"Which of these is considered 'least privilege'?",
     "options":["Giving admin rights to all users","Give users only rights needed for tasks","Users share credentials","No access control"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”âœ‚ï¸", "image":None},
    # 19
    {"id":19, "text":"True or False: HTTPS guarantees a website is completely safe and trustworthy.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ”’â—", "image":None},
    # 20
    {"id":20, "text":"What is a VPN primarily used for?",
     "options":["Faster downloads","Encrypting network traffic and masking IP","Managing local printers","Updating firmware"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ›¡ï¸ğŸŒ", "image":None},
    # 21
    {"id":21, "text":"Which of these is a two-sided authentication factor?",
     "options":["Knowledge factor (password)","Possession factor (token)","Both combined as 2FA","Neither"],
     "answer":2, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”ğŸ”", "image":None},
    # 22
    {"id":22, "text":"What does 'ransomware' do?",
     "options":["Blocks access to resources until a ransom is paid","Optimizes system performance","Removes malware","Protects backups"],
     "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ’°ğŸ§¨", "image":None},
    # 23
    {"id":23, "text":"Which of these is a good practice when receiving attachments from unknown senders?",
     "options":["Open immediately","Scan with antivirus in a sandbox","Forward to everyone","Save to desktop then open"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ—‚ï¸ğŸ”¬", "image":None},
    # 24
    {"id":24, "text":"What is 'social engineering'?",
     "options":["A method of secure coding","Manipulating people to give up confidential info","Engineering social robots","Designing social apps"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ—£ï¸ğŸª„", "image":None},
    # 25
    {"id":25, "text":"Which header indicates a site uses Content Security Policy to reduce XSS?",
     "options":["X-Frame-Options","Content-Security-Policy","Server","Set-Cookie"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§±ğŸ“œ", "image":None},
    # 26
    {"id":26, "text":"True or False: A DMARC record helps reduce email spoofing.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“§ğŸ›¡ï¸", "image":None},
    # 27
    {"id":27, "text":"What is the usual effect of a Distributed Denial of Service (DDoS)?",
     "options":["Increase availability","Make services unavailable by flooding traffic","Encrypt files","Steal credentials"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸŒŠğŸš«", "image":None},
    # 28
    {"id":28, "text":"Which practice defends against credential stuffing attacks?",
     "options":["Enforce reuse of passwords","Rate-limiting and MFA","Use default passwords","Share passwords securely"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸš«", "image":None},
    # 29
    {"id":29, "text":"Which cryptographic primitive ensures data integrity?",
     "options":["Symmetric encryption","Hash functions","Compression","Sorting algorithms"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”—ğŸ§¾", "image":None},
    # 30
    {"id":30, "text":"What does 'least privilege' help to reduce?",
     "options":["Attack surface","Network speed","Battery life","Storage costs"],
     "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“‰ğŸ›¡ï¸", "image":None},
    # 31
    {"id":31, "text":"What's the difference between vulnerability and threat?",
     "options":["Vulnerability is potential weakness; threat is actor or event exploiting it","They are identical","Threat is the fix; vulnerability is the attacker","Vulnerability is a policy, threat is hardware"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"âš ï¸ğŸ¯", "image":None},
    # 32
    {"id":32, "text":"True or False: Public key cryptography uses different keys for encryption and decryption.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ”‘", "image":None},
    # 33
    {"id":33, "text":"Which method would an attacker use to intercept data between two parties?",
     "options":["Man-in-the-Middle (MitM)","Phishing","Brute force","Fingerprinting"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ•µï¸â€â™‚ï¸ğŸ”—", "image":None},
    # 34
    {"id":34, "text":"Which of the following is an example of privileged access?",
     "options":["Standard user reading an email","Sysadmin installing software","Guest browsing a website","Anonymous user on forum"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ‘‘ğŸ› ï¸", "image":None},
    # 35
    {"id":35, "text":"What kind of attack exploits a buffer overflow vulnerability?",
     "options":["SQL Injection","Remote code execution","XSS","Directory traversal"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§ ğŸ’¥", "image":None},
    # 36
    {"id":36, "text":"Which of the following is a secure hashing algorithm?",
     "options":["MD5","SHA-1","SHA-256","CRC32"],
     "answer":2, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ§®", "image":None},
    # 37
    {"id":37, "text":"True or False: An IDS (Intrusion Detection System) can block traffic like an IPS (Intrusion Prevention System).",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ–¥ï¸ğŸš¨", "image":None},
    # 38
    {"id":38, "text":"Which of these helps protect data at rest?",
     "options":["Network monitoring","Full-disk encryption","Firewalls alone","Open ports"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“¦ğŸ”", "image":None},
    # 39
    {"id":39, "text":"What is 'two-person control' (separation of duties) meant to prevent?",
     "options":["Human error and fraud by requiring two people to approve critical actions","Faster approvals","Redundant backups","Unauthorized Wi-Fi access"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ‘¥âœ”ï¸", "image":None},
    # 40
    {"id":40, "text":"Which attack exploits weaknesses in authentication flows to impersonate users?",
     "options":["Session hijacking","Physical theft","Keylogging only","DNS spoofing"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§¾ğŸ”“", "image":None},
    # 41
    {"id":41, "text":"Which of the following is a privacy-focused data minimization technique?",
     "options":["Collect all data and store forever","Collect only what's needed","Share data broadly","Store unencrypted archives"],
     "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ§¾âœ‚ï¸", "image":None},
    # 42
    {"id":42, "text":"Which HTTP method is commonly used to submit form data securely (with TLS)?",
     "options":["GET","POST","DELETE","OPTIONS"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”ğŸŒ", "image":None},
    # 43
    {"id":43, "text":"True or False: An incident response plan (IRP) should be tested regularly.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸš¨ğŸ“", "image":None},
    # 44
    {"id":44, "text":"What is spear-phishing?",
     "options":["Mass-sent phishing","Targeted phishing at a specific individual or group","Phishing via telephone only","A type of firewall"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ¯ğŸ£", "image":None},
    # 45
    {"id":45, "text":"Which of these is a strong defense for web apps against SQL injection?",
     "options":["Concatenate user input into queries","Use parameterized queries/prepared statements","Trust user input","Disable logging"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§©ğŸ›¡ï¸", "image":None},
    # 46
    {"id":46, "text":"Which is the best description of 'honeypot'?",
     "options":["A security patch","A decoy system to attract attackers","A backup server","A type of encryption"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ¯ğŸ•¸ï¸", "image":None},
    # 47
    {"id":47, "text":"True or False: Regularly rotating cryptographic keys can help reduce risk if keys are compromised.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ”‘ğŸ”", "image":None},
    # 48
    {"id":48, "text":"Which of the following best describes 'threat modelling'?",
     "options":["Creating threats for testing","Identifying potential threats and designing mitigations","Recording system logs","Creating passwords"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§­ğŸ›¡ï¸", "image":None},
    # 49
    {"id":49, "text":"What is 'pharming'?",
     "options":["Redirecting users to malicious sites via DNS/cache poisoning","Email phishing","Brute forcing routers","Installing a farm of servers"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸŒ¾ğŸ•¸ï¸", "image":None},
    # 50
    {"id":50, "text":"Which of the following is considered a 'remediation' action?",
     "options":["Identify vulnerability only","Apply patches and mitigate the vulnerability","Ignore alerts","Disable logging"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ› ï¸âœ…", "image":None},
    # 51
    {"id":51, "text":"Which file extension is commonly used for malicious Windows executables?",
     "options":[".exe",".jpg",".txt",".mp3"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ§¾ğŸ’¥", "image":None},
    # 52
    {"id":52, "text":"True or False: 'Zero-day' vulnerability refers to a flaw known to vendor with patches ready.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ•³ï¸â³", "image":None},
    # 53
    {"id":53, "text":"Which of these is used to map domain names to IP addresses?",
     "options":["HTTP","DNS","SMTP","FTP"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“›â¡ï¸ğŸ”¢", "image":None},
    # 54
    {"id":54, "text":"What does 'PKI' stand for?",
     "options":["Private Key Infrastructure","Public Key Infrastructure","Protected Key Interface","Process Key Integration"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”‘ğŸ—ï¸", "image":None},
    # 55
    {"id":55, "text":"Which of these is a privacy regulation from the EU?",
     "options":["GDPR","HIPAA","PCI-DSS","SOX"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ‡ªğŸ‡ºğŸ›¡ï¸", "image":None},
    # 56
    {"id":56, "text":"Which tool category is 'nmap'?",
     "options":["Vulnerability scanner","Network discovery/port scanner","Password manager","Encryption tool"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§­ğŸ”", "image":None},
    # 57
    {"id":57, "text":"True or False: Backing up data protects you fully from ransomware.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ’¾ğŸ”’", "image":None},
    # 58
    {"id":58, "text":"What does MFA stand for?",
     "options":["Multiple File Access","Multi-Factor Authentication","Managed File Authorization","Many-Folder Access"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”ğŸ”", "image":None},
    # 59
    {"id":59, "text":"Which is the most secure way to validate a website's certificate chain?",
     "options":["Ignore browser warnings","Check the certificate in the browser and ensure trusted CA and validity dates","Trust any certificate with HTTPS","Use same certificate for all sites"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“œğŸ”", "image":None},
    # 60
    {"id":60, "text":"What is 'encryption at rest'?",
     "options":["Encrypting data while being transferred","Encrypting stored data on disk or database","Encrypting DNS queries only","Encrypting email headers"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ›ŒğŸ”", "image":None},
    # 61
    {"id":61, "text":"Which of these best prevents SQL injection?",
     "options":["Input validation and prepared statements","Storing passwords plaintext","Using unfiltered user input in queries","Disabling DB logging"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§¾ğŸ”’", "image":None},
    # 62
    {"id":62, "text":"True or False: A VPN hides all malicious activity from your employer.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ•µï¸â€â™€ï¸ğŸš«", "image":None},
    # 63
    {"id":63, "text":"Which of these is used for secure remote shell access?",
     "options":["FTP","SSH","Telnet","HTTP"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”’ğŸ–¥ï¸", "image":None},
    # 64
    {"id":64, "text":"What does 'hashing' do?",
     "options":["Encrypts data symmetrically","Creates a fixed-size digest from input data","Compresses files losslessly","Generates public/private key pairs"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”¢ğŸ”’", "image":None},
    # 65
    {"id":65, "text":"Which tool category is 'Wireshark'?",
     "options":["Network protocol analyzer","Web server","Database","Password manager"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“¡ğŸ”¬", "image":None},
    # 66
    {"id":66, "text":"True or False: Security through obscurity is a strong long-term defense.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ•¶ï¸âŒ", "image":None},
    # 67
    {"id":67, "text":"Which of the following is the best defense against phishing?",
     "options":["User training + email filters + MFA","Only email filters","Only MFA","No defense needed"],
     "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“âœ‰ï¸ğŸ”", "image":None},
    # 68
    {"id":68, "text":"What is an API key supposed to be treated as?",
     "options":["Public information","Secret credential","Database index","CSS style"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”‘ğŸ§¾", "image":None},
    # 69
    {"id":69, "text":"Which of these is NOT part of secure SDLC?",
     "options":["Threat modeling","Code review","Ignoring user input","Penetration testing"], "answer":2, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ› ï¸", "image":None},
    # 70
    {"id":70, "text":"True or False: Penetration testing and vulnerability scanning are the same.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ•µï¸â€â™‚ï¸ğŸ”", "image":None},
    # 71
    {"id":71, "text":"Which of these is used to uniquely identify a device on a network?",
     "options":["MAC Address","Username","Folder name","Process ID"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”¢ğŸ“¶", "image":None},
    # 72
    {"id":72, "text":"Which control addresses insider threats the best?",
     "options":["Monitoring and access controls","Turning off all systems","Granting everyone admin rights","Leaving logs disabled"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ‘€ğŸ”", "image":None},
    # 73
    {"id":73, "text":"What does 'PCI-DSS' relate to?",
     "options":["Healthcare records","Payment card industry security standard","DNS configuration","Operating system updates"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ’³ğŸ›¡ï¸", "image":None},
    # 74
    {"id":74, "text":"True or False: Air-gapped systems are completely immune to attacks.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"âœˆï¸ğŸš«", "image":None},
    # 75
    {"id":75, "text":"Which of these is the best place to store secrets in production?",
     "options":["Plain text files in repo","Secrets manager (vault)","Public bucket","Shared spreadsheets"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ—ï¸ğŸ¦", "image":None},
    # 76
    {"id":76, "text":"Which of the following indicates a weak security practice?",
     "options":["Unique per-user passwords","Password reuse across sites","MFA","Account lockout after many attempts"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"â™»ï¸ğŸ”“", "image":None},
    # 77
    {"id":77, "text":"What is the goal of 'red team' exercises?",
     "options":["Patch systems","Act like attackers to test defenses","Manage backups","Write documentation"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”´âš”ï¸", "image":None},
    # 78
    {"id":78, "text":"True or False: Default credentials should be changed before deploying devices.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ”‘âš ï¸", "image":None},
    # 79
    {"id":79, "text":"Which tool helps manage software dependencies and known vulnerabilities?",
     "options":["Dependency scanner / SCA tool","Plain text editor","Paint","Calculator"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“¦ğŸ”", "image":None},
    # 80
    {"id":80, "text":"Which log type is most useful for investigating network-based intrusions?",
     "options":["Application logs only","Network flow and firewall logs","Word docs","Presentation files"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“ŠğŸ§¾", "image":None},
    # 81
    {"id":81, "text":"What does 'SLA' stand for in operational contexts?",
     "options":["Security Log Analytics","Service Level Agreement","System Log Archive","Secure Layer Access"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“œğŸ¤", "image":None},
    # 82
    {"id":82, "text":"Which of these is an example of physical security control?",
     "options":["Encryption at rest","Biometric access to server room","Firewall rules","Password policies"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”’ğŸ¢", "image":None},
    # 83
    {"id":83, "text":"True or False: A secure backup strategy should include offline copies.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ’¾ğŸ›¡ï¸", "image":None},
    # 84
    {"id":84, "text":"Which is the most important when creating a secure password policy?",
     "options":["Mandating extremely short passwords","Balancing complexity and usability plus encouraging passphrases","Allowing password reuse","No expiration at all"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ’¡", "image":None},
    # 85
    {"id":85, "text":"What is the best definition of 'phishing simulation' used in training?",
     "options":["A real attack without consent","A fake phishing exercise to test/training users","Email marketing campaign","A backup procedure"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ§ªğŸ£", "image":None},
    # 86
    {"id":86, "text":"Which of these is a common cause of accidental data leakage?",
     "options":["Strong encryption","Misconfigured cloud storage buckets","Multi-factor auth","Stringent access controls"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"â˜ï¸ğŸ”“", "image":None},
    # 87
    {"id":87, "text":"True or False: A 'logic bomb' is malware that triggers under certain conditions.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ’£ğŸ•°ï¸", "image":None},
    # 88
    {"id":88, "text":"What is 'privilege escalation'?",
     "options":["Losing permissions","Gaining higher permissions than allowed","Deleting user accounts","Changing wallpaper"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"â¬†ï¸ğŸ‘‘", "image":None},
    # 89
    {"id":89, "text":"Which of these steps is first during incident response?",
     "options":["Containment","Eradication","Preparation and identification","Recovery"], "answer":2, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§¯ğŸ“‹", "image":None},
    # 90
    {"id":90, "text":"True or False: TLS and SSL are protocols used to secure communications.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ”’ğŸ”", "image":None},
    # 91
    {"id":91, "text":"What does 'IOC' stand for in threat hunting?",
     "options":["Indicator of Compromise","Internet of Components","Index of Credentials","Initial Owned Computer"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”âš ï¸", "image":None},
    # 92
    {"id":92, "text":"Which practice helps reduce phishing click rates?",
     "options":["User awareness training","Auto-accept files","Disable MFA","Use default passwords"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ“ğŸ“§", "image":None},
    # 93
    {"id":93, "text":"True or False: Using 'admin' as username is a good security practice.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ‘¤âŒ", "image":None},
    # 94
    {"id":94, "text":"Which of the following best describes 'defense in depth'?",
     "options":["Multiple layers of security controls","One strong control only","No controls","Outsource everything"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§±ğŸ§±ğŸ§±", "image":None},
    # 95
    {"id":95, "text":"Which is commonly used to persist malicious activity across reboots?",
     "options":["Modifying startup scripts or registry entries","Deleting logs","Using strong passwords","Running backups"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ‘¾", "image":None},
    # 96
    {"id":96, "text":"What is 'DNS poisoning' used for?",
     "options":["Speeding DNS resolution","Redirecting domain names to malicious IPs","Encrypting DNS","Blocking DNS entirely"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§ªğŸŒ", "image":None},
    # 97
    {"id":97, "text":"True or False: Access logs are useless for forensic analysis.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ—„ï¸ğŸ”", "image":None},
    # 98
    {"id":98, "text":"Which of the following is a form of biometric authentication?",
     "options":["OTP over email","Fingerprint scanner","Password manager","Firewall rule"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ–ï¸ğŸ”’", "image":None},
    # 99
    {"id":99, "text":"Which approach helps to protect API endpoints?",
     "options":["Rate limiting, auth tokens, input validation","Opening all ports","Using admin credentials in code","No logging"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ§©", "image":None},
    # 100
    {"id":100, "text":"True or False: Security policies should be documented and communicated to employees.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ“œğŸ—£ï¸", "image":None},
    # 101
    {"id":101, "text":"Which of these is a way to securely handle file uploads in a web app?",
     "options":["Allow all file types and sizes","Validate file type, size, scan and store outside webroot","Save with user-supplied filename","Execute uploaded files directly"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“ğŸ”", "image":None},
    # 102
    {"id":102, "text":"Which of the following is considered social engineering via phone calls?",
     "options":["Vishing","Smishing","Pharming","Spoofing"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“ğŸ£", "image":None},
    # 103
    {"id":103, "text":"True or False: 'Smishing' is phishing delivered via SMS.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ“±ğŸ£", "image":None},
    # 104
    {"id":104, "text":"What's the purpose of 'hash salting'?",
     "options":["Make hash deterministic","Make brute-force against hashed passwords more difficult","Reduce hash size","Speed up hashing"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§‚ğŸ”’", "image":None},
    # 105
    {"id":105, "text":"Which of these is a common mistake leading to data exposure in cloud services?",
     "options":["Misconfigured access control lists or public buckets","Strict IAM policies","Encryption by default","MFA enforcement"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"â˜ï¸ğŸ”“", "image":None},
    # 106
    {"id":106, "text":"True or False: You should ignore software end-of-life warnings because they are optional.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ•°ï¸âš ï¸", "image":None},
    # 107
    {"id":107, "text":"Which of these is a secure method to provision servers?",
     "options":["Manual provisioning with insecure defaults","Infrastructure as code with secure templates and secrets management","Copying production config to public repo","Using manufacturer default passwords"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ—ï¸ğŸ§¾", "image":None},
    # 108
    {"id":108, "text":"Which of the following is a kind of advanced persistent threat (APT) hallmark?",
     "options":["Short-lived noisy attacks only","Long-term, stealthy presence and data exfiltration","Only physical attacks","Only web defacement"],
     "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ•µï¸â€â™€ï¸ğŸ•°ï¸", "image":None},
    # 109
    {"id":109, "text":"True or False: Logging sensitive data (like passwords) in plaintext is acceptable for debug builds.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“âŒ", "image":None},
    # 110
    {"id":110, "text":"What is 'cryptographic nonce' used for?",
     "options":["Ensure uniqueness to prevent replay attacks","Act as a master password","Compress data","Format logs"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”¢ğŸ›¡ï¸", "image":None},
    # 111
    {"id":111, "text":"Which metric measures how quickly a system recovers after an incident?",
     "options":["MTTR (Mean Time To Recover)","MTBF","TTR","RTT"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"â±ï¸ğŸ”", "image":None},
    # 112
    {"id":112, "text":"True or False: Certificate pinning can help mitigate MitM attacks in mobile apps.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“ŒğŸ”’", "image":None},
    # 113
    {"id":113, "text":"Which of these is a good practice when sharing code publicly?",
     "options":["Include API keys and secrets","Remove secrets and sanitize configs","Share database passwords","Expose internal IPs without context"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ’»ğŸ”", "image":None},
    # 114
    {"id":114, "text":"Which technique is used to obscure real IP addresses for anonymity?",
     "options":["VPN and Tor","Plain HTTP","FTP only","SMTP"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ•¸ï¸ğŸ›¡ï¸", "image":None},
    # 115
    {"id":115, "text":"True or False: A strong CSP (Content Security Policy) can mitigate many XSS vectors.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ§±ğŸ–¥ï¸", "image":None},
    # 116
    {"id":116, "text":"What is 'certificate revocation' used for?",
     "options":["Remove trust from compromised or invalid certificates","Make certificates stronger","Accelerate TLS handshake","Generate new keys automatically"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“›âŒ", "image":None},
    # 117
    {"id":117, "text":"Which of these indicates possible credential compromise?",
     "options":["Multiple failed logins followed by success from unusual location","Single successful login from familiar device","Planned maintenance","Scheduled backup"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸš¨ğŸ“", "image":None},
    # 118
    {"id":118, "text":"True or False: Using the same salt for every password provides the best protection.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ§‚âŒ", "image":None},
    # 119
    {"id":119, "text":"Which is a function of DLP (Data Loss Prevention) tools?",
     "options":["Prevent unauthorized data exfiltration","Distribute malware","Format disks","Change passwords automatically"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸš«ğŸ“¤", "image":None},
    # 120
    {"id":120, "text":"Which of the following is a code injection attack?",
     "options":["SQL injection","DDoS","Phishing","Brute force"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§©âš ï¸", "image":None},
    # 121
    {"id":121, "text":"True or False: TLS 1.0 and 1.1 are recommended for modern secure communications.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“‰ğŸ”’", "image":None},
    # 122
    {"id":122, "text":"What is 'cyber hygiene'?",
     "options":["Daily personal cleaning tasks","Practices to maintain system security like patching, backups, passwords","Disaster recovery plan only","Antivirus installation only"], "answer":1, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ§¼ğŸ’»", "image":None},
    # 123
    {"id":123, "text":"Which of the following helps protect credentials in applications?",
     "options":["Store credentials in code","Use environment variables and secrets manager","Share credentials in chat","Hardcode credentials"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ›¡ï¸ğŸ”‘", "image":None},
    # 124
    {"id":124, "text":"True or False: Security awareness training only needs to be done once.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ“ğŸ”", "image":None},
    # 125
    {"id":125, "text":"Which authentication standard is commonly used for federated logins (social login)?",
     "options":["OAuth 2.0 / OpenID Connect","FTP","SMTP","SNMP"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”—ğŸ†”", "image":None},
    # 126
    {"id":126, "text":"Which is a sign of credential stuffing in logs?",
     "options":["Many login attempts for many accounts from same IP","Single login attempt","Single logout","Regular backups"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§ªğŸ”", "image":None},
    # 127
    {"id":127, "text":"True or False: A web app's CSRF token should be unpredictable and tied to the user's session.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ”€ğŸ›¡ï¸", "image":None},
    # 128
    {"id":128, "text":"Which of the following is a good practice for container security?",
     "options":["Run containers as root in production","Use minimal base images and least privilege","Publish secret env vars in public repo","Disable resource limits"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ³ğŸ”", "image":None},
    # 129
    {"id":129, "text":"Which of these is a valid reason to perform a vulnerability scan?",
     "options":["To find potential weaknesses to remediate","To break production systems unintentionally","To exfiltrate data","To disable logs"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”ğŸ©º", "image":None},
    # 130
    {"id":130, "text":"True or False: Using network segmentation can limit lateral movement during a breach.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ§±â¡ï¸", "image":None},
    # 131
    {"id":131, "text":"What is the best immediate action when a malware infection is confirmed on a workstation?",
     "options":["Isolate the workstation from the network","Continue normal operations","Delete system32","Reboot repeatedly"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸšªğŸ”’", "image":None},
    # 132
    {"id":132, "text":"Which of the following helps detect abnormal user behavior?",
     "options":["UEBA (User and Entity Behavior Analytics)","Only antivirus","Only firewall rules","No logs"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ‘¤ğŸ“ˆ", "image":None},
    # 133
    {"id":133, "text":"True or False: Open-source software cannot be secure because source code is public.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸŒğŸ”“", "image":None},
    # 134
    {"id":134, "text":"Which of these is recommended for secure remote workforce?",
     "options":["Enforce MFA, VPN or Zero Trust access, device posture checks","Allow any device without checks","Share one password for all","Disable authentication"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ ğŸ›¡ï¸", "image":None},
    # 135
    {"id":135, "text":"What is 'exfiltration' in cyber security?",
     "options":["Moving data legally between departments","Stealing data out of a network","Encrypting backups","Installing updates"], "answer":1, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“¤ğŸš¨", "image":None},
    # 136
    {"id":136, "text":"True or False: Regular code reviews help identify security bugs early.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ‘€ğŸ’»", "image":None},
    # 137
    {"id":137, "text":"Which of these is a good practice when designing APIs?",
     "options":["Use strong auth, validate inputs, rate-limit, and log","Trust all client input","Return full stack traces to clients","Use hardcoded secrets"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ§­ğŸ”", "image":None},
    # 138
    {"id":138, "text":"Which of these is a hallmark of ransomware?",
     "options":["Data encrypted and ransom note demanding payment","Faster file access","Lighter CPU usage","Improved performance"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ’¸ğŸ”’", "image":None},
    # 139
    {"id":139, "text":"True or False: Removing unused ports and services reduces attack surface.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ› ï¸ğŸ“‰", "image":None},
    # 140
    {"id":140, "text":"Which of these helps defend against supply chain attacks?",
     "options":["Vendor vetting, SBOMs, security requirements in contracts","No vendor checks","Blindly trusting third parties","Disable monitoring"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”—ğŸ“œ", "image":None},
    # 141
    {"id":141, "text":"Which of these is an example of 'security through transparency' benefit?",
     "options":["Open review of designs reduces hidden vulnerabilities","Hiding designs prevents attackers","Ignoring audits","No logging"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ¤", "image":None},
    # 142
    {"id":142, "text":"True or False: A SOC (Security Operations Center) typically monitors, detects and responds to threats.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Beginner", "tgif":"ğŸ›°ï¸ğŸš¨", "image":None},
    # 143
    {"id":143, "text":"Which term describes attackers selling access to compromised systems?",
     "options":["Initial access broker","Penetration tester","Bug bounty hunter","Red teamer"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ’¼ğŸ”“", "image":None},
    # 144
    {"id":144, "text":"Which of the following is a strong indicator of phishing URL?",
     "options":["Misspelt domain and strange subdomains","Short domain with correct spelling","Company email domain","Secure padlock icon only"], "answer":0, "type":"mcq", "difficulty":"Beginner", "tgif":"ğŸ”—ğŸ£", "image":None},
    # 145
    {"id":145, "text":"True or False: You should keep default firmware on network devices indefinitely.",
     "options":["True","False"], "answer":1, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“¶âš ï¸", "image":None},
    # 146
    {"id":146, "text":"What is 'tokenization' typically used for?",
     "options":["Replacing sensitive data with non-sensitive tokens","Increasing CPU speed","Compressing files","Backing up data"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ”ğŸ”", "image":None},
    # 147
    {"id":147, "text":"Which control helps detect suspicious exfiltration over DNS?",
     "options":["DNS logging and anomaly detection","Disable DNS entirely","Use only plain text emails","Always allow DNS tunneling"], "answer":0, "type":"mcq", "difficulty":"Advanced (but approachable)","tgif":"ğŸ¾ğŸŒ", "image":None},
    # 148
    {"id":148, "text":"True or False: Security baselines are standardized configurations that help reduce misconfigurations.",
     "options":["True","False"], "answer":0, "type":"tf", "difficulty":"Intermediate", "tgif":"ğŸ“âš™ï¸", "image":None},
    # 149
    {"id":149, "text":"Which of these is most useful for tracking software dependencies and licenses?",
     "options":["SBOM (Software Bill of Materials)","Plain text README","Binary blobs","Random notes"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"ğŸ“œğŸ§¾", "image":None},
    # 150
    {"id":150, "text":"Which of these is an effective anti-phishing UI feature in email clients?",
     "options":["Display sender verification, show warnings for spoofed senders","Always trust external senders","Auto-open attachments","Hide sender details"], "answer":0, "type":"mcq", "difficulty":"Intermediate", "tgif":"âš ï¸ğŸ“§ğŸ”’", "image":None},
]

# ---------------------
# Utility: map by id for quick lookup
QUESTIONS_BY_ID = {q["id"]: q for q in QUESTIONS}

# ---------------------
# ROUTES
# ---------------------
INDEX_HTML = """
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Coding Temple â€” Cyber Trivia Game Night</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family:system-ui,Segoe UI,Roboto,Arial; margin:0; padding:0; background:#0f172a; color:#e6eef8; }
    header { padding:18px; background: linear-gradient(90deg,#0b1220,#10243a); display:flex; align-items:center; justify-content:space-between; }
    .brand { font-weight:700; font-size:20px; display:flex; gap:10px; align-items:center; }
    .container { padding:18px; max-width:1200px; margin:0 auto; }
    .controls { display:flex; gap:12px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(54px,1fr)); gap:8px; margin-top:12px; }
    .tile { background:#082033; border-radius:999px; padding:12px; text-align:center; cursor:pointer; border:2px solid transparent; box-shadow:0 4px 10px rgba(2,6,23,0.6); }
    .tile.hidden { background:linear-gradient(135deg,#061422,#0c2233); color:#9fb6d3; }
    .tile.used { opacity:0.45; pointer-events:none; transform:scale(0.98); }
    button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; background:#065f46; color:white; font-weight:600; }
    .die { font-size:22px; padding:10px 14px; background:#07203a; border-radius:8px; border:1px solid #143b55; color:#bfe3d6; }
    .panel { margin-top:18px; background:linear-gradient(0deg,#071624,#0d2436); padding:14px; border-radius:12px; box-shadow:0 8px 24px rgba(2,6,23,0.7); }
    .question { font-size:18px; margin-bottom:8px; }
    .options { display:flex; flex-direction:column; gap:8px; }
    .opt { padding:10px; border-radius:8px; background:#0b2a3a; border:1px solid #123b53; cursor:pointer; }
    .opt.correct { background:#065f46; color:white; border-color:#065f46; }
    .opt.wrong { background:#7f1d1d; color:white; border-color:#7f1d1d; }
    .scoreboard { display:flex; gap:12px; align-items:center; }
    .team { background:#072033; padding:8px 12px; border-radius:8px; }
    .muted { color:#9fb6d3; font-size:13px; }
    img.phish { max-width:70%; margin:8px 0; border-radius:8px; border:1px solid #123b53; }
    footer { padding:12px; text-align:center; color:#9fb6d3; font-size:13px; }
    @media (max-width:700px){ .grid { grid-template-columns: repeat(auto-fill,minmax(44px,1fr)); } .question { font-size:16px; } }
  </style>
</head>
<body>
  <header>
    <div class="brand">ğŸ® Coding Temple â€” Cyber Trivia Night <span class="muted" style="font-size:13px; margin-left:8px;">(Beginner â†’ Intermediate)</span></div>
    <div class="muted">TGIF emoji tags = ğŸ”’ security / ğŸ£ phishing / ğŸ§  concepts</div>
  </header>

  <div class="container">
    <div class="controls">
      <div class="scoreboard">
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="teamAName" placeholder="Team A" style="padding:6px;border-radius:8px;border:none;background:#062034;color:#e6eef8;" value="Team Alpha">
          <input id="teamBName" placeholder="Team B" style="padding:6px;border-radius:8px;border:none;background:#062034;color:#e6eef8;" value="Team Bravo">
        </div>
        <div class="team"> <strong id="teamA">Team Alpha</strong> : <span id="scoreA">0</span> </div>
        <div class="team"> <strong id="teamB">Team Bravo</strong> : <span id="scoreB">0</span> </div>
      </div>

      <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <button id="rollBtn">ğŸ² Roll Die</button>
        <div class="die" id="dieResult">â€”</div>
        <button id="resetBtn" style="background:#a3a3a3;color:#042028;">Reset Game</button>
      </div>
    </div>

    <div class="muted">Click a numbered circle to reveal a question (or use Roll Die to auto-pick). Used questions are disabled.</div>
    <div id="grid" class="grid"></div>

    <div id="panel" class="panel" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><strong id="qId">Q#</strong> <span id="qTgif" class="muted"></span></div>
        <div class="muted">Difficulty: <span id="qDifficulty"></span></div>
      </div>

      <div class="question" id="qText"></div>
      <img id="qImage" class="phish" style="display:none;" alt="question image">
      <div class="options" id="qOptions"></div>

      <div style="display:flex; gap:8px; margin-top:12px; align-items:center;">
        <div class="muted">Active team:</div>
        <select id="activeTeam">
          <option value="A">Team A</option>
          <option value="B">Team B</option>
        </select>
        <div style="margin-left:auto;">
          <button id="closeQ">Close</button>
        </div>
      </div>
    </div>

    <footer>
      Tip: Add phishing images into <code>static/images/</code> and set question.image to point to them. The TGIF emoji per question helps theme tiles visually.
    </footer>
  </div>

<script>
  const TOTAL = {{total}};
  const grid = document.getElementById('grid');
  const dieResult = document.getElementById('dieResult');
  const rollBtn = document.getElementById('rollBtn');
  const panel = document.getElementById('panel');
  const qText = document.getElementById('qText');
  const qOptions = document.getElementById('qOptions');
  const qId = document.getElementById('qId');
  const qTgif = document.getElementById('qTgif');
  const qDifficulty = document.getElementById('qDifficulty');
  const qImage = document.getElementById('qImage');
  const activeTeam = document.getElementById('activeTeam');
  const scoreAEl = document.getElementById('scoreA');
  const scoreBEl = document.getElementById('scoreB');
  const teamAName = document.getElementById('teamAName');
  const teamBName = document.getElementById('teamBName');
  const teamAEl = document.getElementById('teamA');
  const teamBEl = document.getElementById('teamB');
  const resetBtn = document.getElementById('resetBtn');

  let used = new Set();
  let currentQuestion = null;
  let scores = {A:0,B:0};

  function buildGrid(){
    grid.innerHTML = '';
    for(let i=1;i<=TOTAL;i++){
      const t = document.createElement('div');
      t.className = 'tile hidden';
      t.id = 'tile-'+i;
      t.innerText = i;
      t.onclick = ()=> pickQuestion(i);
      grid.appendChild(t);
    }
  }

  async function pickQuestion(id){
    if(used.has(id)) return;
    // fetch question
    const resp = await fetch('/api/question/' + id);
    if(!resp.ok){ alert('Question not found'); return; }
    const q = await resp.json();
    currentQuestion = q;
    showQuestion(q);
    // mark as used after showing
    used.add(id);
    document.getElementById('tile-'+id).classList.add('used');
  }

  function showQuestion(q){
    panel.style.display = 'block';
    qId.innerText = 'Q#' + q.id;
    qTgif.innerText = q.tgif ? (' ' + q.tgif) : '';
    qDifficulty.innerText = q.difficulty || '';
    qText.innerText = q.text;
    qOptions.innerHTML = '';
    qImage.style.display = 'none';
    if(q.image){
      qImage.src = q.image;
      qImage.style.display = 'block';
    }
    q.options.forEach((opt, idx) => {
      const d = document.createElement('div');
      d.className = 'opt';
      d.innerText = opt;
      d.onclick = ()=> selectOption(idx, d);
      qOptions.appendChild(d);
    });
  }

  async function selectOption(idx, dom){
    if(currentQuestion == null) return;
    // ask backend if correct
    const resp = await fetch('/api/answer', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({id: currentQuestion.id, selected: idx})
    });
    const data = await resp.json();
    // show feedback
    const opts = qOptions.children;
    for(let i=0;i<opts.length;i++){
      opts[i].onclick = null; // disable further clicking
      opts[i].classList.remove('correct','wrong');
    }
    if(data.correct){
      dom.classList.add('correct');
      // update score
      const team = activeTeam.value;
      scores[team] += 1;
      updateScores();
    } else {
      dom.classList.add('wrong');
      // show correct
      const correctIdx = data.correctIndex;
      if(correctIdx != null && opts[correctIdx]) opts[correctIdx].classList.add('correct');
    }
  }

  function updateScores(){
    scoreAEl.innerText = scores.A;
    scoreBEl.innerText = scores.B;
  }

  rollBtn.onclick = async ()=>{
    const n = Math.floor(Math.random()*TOTAL) + 1;
    dieResult.innerText = n;
    await pickQuestion(n);
  };

  document.getElementById('closeQ').onclick = ()=>{
    panel.style.display = 'none';
    currentQuestion = null;
  };

  teamAName.oninput = ()=> teamAEl.innerText = teamAName.value || 'Team A';
  teamBName.oninput = ()=> teamBEl.innerText = teamBName.value || 'Team B';

  resetBtn.onclick = ()=>{
    if(!confirm('Reset game? This will mark all questions unused and reset scores.')) return;
    used = new Set();
    scores = {A:0,B:0};
    updateScores();
    dieResult.innerText = 'â€”';
    panel.style.display = 'none';
    buildGrid();
  };

  // init
  buildGrid();
  updateScores();
</script>
</body>
</html>
"""

@app.route("/")
def index():
    return render_template_string(INDEX_HTML, total=TOTAL_QUESTIONS)

@app.route("/api/question/<int:q_id>")
def api_question(q_id):
    q = QUESTIONS_BY_ID.get(q_id)
    if not q:
        return jsonify({"error":"not found"}), 404
    # Return question but do NOT include 'answer' index â€” frontend must call /api/answer to check
    q_public = {k: v for k, v in q.items() if k != "answer"}
    return jsonify(q_public)

@app.route("/api/answer", methods=["POST"])
def api_answer():
    data = request.get_json() or {}
    qid = int(data.get("id", 0))
    sel = int(data.get("selected", -1))
    q = QUESTIONS_BY_ID.get(qid)
    if not q:
        return jsonify({"error":"question not found"}), 404
    correct_index = q["answer"]
    is_correct = (sel == correct_index)
    return jsonify({"correct": is_correct, "correctIndex": correct_index})

# static images route (Flask static folder will serve /static automatically)
@app.route("/static/<path:filename>")
def static_files(filename):
    return send_from_directory("static", filename)

if __name__ == "__main__":
    # create static/images dir if not exists so user can drop images there
    os.makedirs(os.path.join(os.getcwd(), "static", "images"), exist_ok=True)
    print("Starting Cyber Trivia App â€” open http://127.0.0.1:5000")
    app.run(debug=True)
